
License:  Simplified BSD, see LICENSE. 

zstatd is a Perl daemon for Illumos ZFS storage servers that collects 
storage-relevant system stats from kstat() and feeds them to 
graphite/carbon for logging, monitoring and visualization.

(See http://graphite.wikidot.com/)

Stats are stored at 10 second intervals as total counters, but it is
trivial to take derivatives from graphite for rates.

zstatd has been particularly valuable for tuning and debugging.  
Metadata cache misses are kryptonite for ZFS performance and provide
particularly valuable information.

I don't really love Perl but it's by far the easiest way to extract 
these metrics.  There are only three access methods for Illumos/Solaris 
kstat(): C, Perl, and the 'kstat' shell executable.   

This code was written on OmniOS and it works on OpenIndiana.  
It would probably work on Oracle Solaris and FreeBSD with little 
modification, but neither has been tested. The Sun::Solaris::Kstat 
module does appear to work on FreeBSD.

The SMF service name is svc:/system/zstat:default and the 
self-documenting config file is zstat.conf, per the 
Illumos/Solaris standard. 

See sbin/zstatd for required Perl modules.

Files (with intended install prefixes):

[/usr/local/] sbin/zstatd                  -- Perl executable 
[/usr/local/] etc/zstat.conf               -- config file 
[/lib/]       svc/method/zstat             -- SMF start/stop script 
[/var/]       svc/manifest/site/zstat.xml  -- SMF service manifest 

samples/      -- sample graphite images using zstatd metrics

    -- Trey Palmer, 12/28/2014
